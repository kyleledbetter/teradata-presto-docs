

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7.16. SELECT &mdash; Teradata Presto 0.144-SNAPSHOT Documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/teradata.css" type="text/css" />
  

  

  
    <link rel="top" title="Teradata Presto 0.144-SNAPSHOT Documentation" href="../index.html"/>
        <link rel="up" title="7. SQL Statement Syntax" href="../sql.html"/>
        <link rel="next" title="7.17. SET SESSION" href="set-session.html"/>
        <link rel="prev" title="7.15. ROLLBACK" href="rollback.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Teradata Presto
          

          
          </a>

          
            
            
              <div class="version">
                0.144-SNAPSHOT
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin.html">3. Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connector.html">4. Connectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">5. Functions and Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language.html">6. SQL Language</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../sql.html">7. SQL Statement Syntax</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="alter-table.html">7.1. ALTER TABLE</a></li>
<li class="toctree-l2"><a class="reference internal" href="call.html">7.2. CALL</a></li>
<li class="toctree-l2"><a class="reference internal" href="commit.html">7.3. COMMIT</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-table.html">7.4. CREATE TABLE</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-table-as.html">7.5. CREATE TABLE AS</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-view.html">7.6. CREATE VIEW</a></li>
<li class="toctree-l2"><a class="reference internal" href="delete.html">7.7. DELETE</a></li>
<li class="toctree-l2"><a class="reference internal" href="describe.html">7.8. DESCRIBE</a></li>
<li class="toctree-l2"><a class="reference internal" href="drop-table.html">7.9. DROP TABLE</a></li>
<li class="toctree-l2"><a class="reference internal" href="drop-view.html">7.10. DROP VIEW</a></li>
<li class="toctree-l2"><a class="reference internal" href="explain.html">7.11. EXPLAIN</a></li>
<li class="toctree-l2"><a class="reference internal" href="explain-analyze.html">7.12. EXPLAIN ANALYZE</a></li>
<li class="toctree-l2"><a class="reference internal" href="insert.html">7.13. INSERT</a></li>
<li class="toctree-l2"><a class="reference internal" href="reset-session.html">7.14. RESET SESSION</a></li>
<li class="toctree-l2"><a class="reference internal" href="rollback.html">7.15. ROLLBACK</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">7.16. SELECT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#synopsis">Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#with-clause">WITH Clause</a></li>
<li class="toctree-l3"><a class="reference internal" href="#group-by-clause">GROUP BY Clause</a></li>
<li class="toctree-l3"><a class="reference internal" href="#having-clause">HAVING Clause</a></li>
<li class="toctree-l3"><a class="reference internal" href="#union-clause">UNION Clause</a></li>
<li class="toctree-l3"><a class="reference internal" href="#order-by-clause">ORDER BY Clause</a></li>
<li class="toctree-l3"><a class="reference internal" href="#limit-clause">LIMIT Clause</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tablesample">TABLESAMPLE</a></li>
<li class="toctree-l3"><a class="reference internal" href="#unnest">UNNEST</a></li>
<li class="toctree-l3"><a class="reference internal" href="#joins">Joins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cross-join">CROSS JOIN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#qualifying-column-names">Qualifying Column Names</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="set-session.html">7.17. SET SESSION</a></li>
<li class="toctree-l2"><a class="reference internal" href="show-catalogs.html">7.18. SHOW CATALOGS</a></li>
<li class="toctree-l2"><a class="reference internal" href="show-columns.html">7.19. SHOW COLUMNS</a></li>
<li class="toctree-l2"><a class="reference internal" href="show-functions.html">7.20. SHOW FUNCTIONS</a></li>
<li class="toctree-l2"><a class="reference internal" href="show-partitions.html">7.21. SHOW PARTITIONS</a></li>
<li class="toctree-l2"><a class="reference internal" href="show-schemas.html">7.22. SHOW SCHEMAS</a></li>
<li class="toctree-l2"><a class="reference internal" href="show-session.html">7.23. SHOW SESSION</a></li>
<li class="toctree-l2"><a class="reference internal" href="show-tables.html">7.24. SHOW TABLES</a></li>
<li class="toctree-l2"><a class="reference internal" href="start-transaction.html">7.25. START TRANSACTION</a></li>
<li class="toctree-l2"><a class="reference internal" href="use.html">7.26. USE</a></li>
<li class="toctree-l2"><a class="reference internal" href="values.html">7.27. VALUES</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">8. Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop.html">9. Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">10. Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Teradata Presto</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
        <li><a href="../sql.html">7. SQL Statement Syntax</a> &raquo;</li>
      
    <li>7.16. SELECT</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="../_sources/sql/select.txt" rel="nofollow"> View page source</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="select">
<h1>7.16. SELECT</h1>
<div class="section" id="synopsis">
<h2>Synopsis</h2>
<div class="highlight-none"><div class="highlight"><pre><span></span>[ WITH with_query [, ...] ]
SELECT [ ALL | DISTINCT ] select_expr [, ...]
[ FROM from_item [, ...] ]
[ WHERE condition ]
[ GROUP BY [ ALL | DISTINCT ] grouping_element [, ...] ]
[ HAVING condition]
[ UNION [ ALL | DISTINCT ] select ]
[ ORDER BY expression [ ASC | DESC ] [, ...] ]
[ LIMIT [ count | ALL ] ]
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">from_item</span></code> is one of</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>table_name [ [ AS ] alias [ ( column_alias [, ...] ) ] ]
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>from_item join_type from_item [ ON join_condition | USING ( join_column [, ...] ) ]
</pre></div>
</div>
<p>and <code class="docutils literal"><span class="pre">join_type</span></code> is one of</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>[ INNER ] JOIN
LEFT [ OUTER ] JOIN
RIGHT [ OUTER ] JOIN
FULL [ OUTER ] JOIN
CROSS JOIN
</pre></div>
</div>
<p>and <code class="docutils literal"><span class="pre">grouping_element</span></code> is one of</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>()
expression
GROUPING SETS ( ( column [, ...] ) [, ...] )
CUBE ( column [, ...] )
ROLLUP ( column [, ...] )
</pre></div>
</div>
</div>
<div class="section" id="description">
<h2>Description</h2>
<p>Retrieve rows from zero or more tables.</p>
</div>
<div class="section" id="with-clause">
<h2>WITH Clause</h2>
<p>The <code class="docutils literal"><span class="pre">WITH</span></code> clause defines named relations for use within a query.
It allows flattening nested queries or simplifying subqueries.
For example, the following queries are equivalent:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
<span class="k">FROM</span> <span class="p">(</span>
  <span class="k">SELECT</span> <span class="n">a</span><span class="p">,</span> <span class="k">MAX</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">AS</span> <span class="n">b</span> <span class="k">FROM</span> <span class="n">t</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">a</span>
<span class="p">)</span> <span class="k">AS</span> <span class="n">x</span><span class="p">;</span>

<span class="k">WITH</span> <span class="n">x</span> <span class="k">AS</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">a</span><span class="p">,</span> <span class="k">MAX</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">AS</span> <span class="n">b</span> <span class="k">FROM</span> <span class="n">t</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">a</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="k">FROM</span> <span class="n">x</span><span class="p">;</span>
</pre></div>
</div>
<p>This also works with multiple subqueries:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">WITH</span>
  <span class="n">t1</span> <span class="k">AS</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">a</span><span class="p">,</span> <span class="k">MAX</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">AS</span> <span class="n">b</span> <span class="k">FROM</span> <span class="n">x</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">a</span><span class="p">),</span>
  <span class="n">t2</span> <span class="k">AS</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">a</span><span class="p">,</span> <span class="k">AVG</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">AS</span> <span class="n">d</span> <span class="k">FROM</span> <span class="n">y</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">a</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="n">t1</span><span class="p">.</span><span class="o">*</span><span class="p">,</span> <span class="n">t2</span><span class="p">.</span><span class="o">*</span>
<span class="k">FROM</span> <span class="n">t1</span>
<span class="k">JOIN</span> <span class="n">t2</span> <span class="k">ON</span> <span class="n">t1</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">t2</span><span class="p">.</span><span class="n">a</span><span class="p">;</span>
</pre></div>
</div>
<p>Additionally, the relations within a <code class="docutils literal"><span class="pre">WITH</span></code> clause can chain:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">WITH</span>
  <span class="n">x</span> <span class="k">AS</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">a</span> <span class="k">FROM</span> <span class="n">t</span><span class="p">),</span>
  <span class="n">y</span> <span class="k">AS</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">a</span> <span class="k">AS</span> <span class="n">b</span> <span class="k">FROM</span> <span class="n">x</span><span class="p">),</span>
  <span class="n">z</span> <span class="k">AS</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">b</span> <span class="k">AS</span> <span class="k">c</span> <span class="k">FROM</span> <span class="n">y</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="k">c</span> <span class="k">FROM</span> <span class="n">z</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="group-by-clause">
<h2>GROUP BY Clause</h2>
<p>The <code class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clause divides the output of a <code class="docutils literal"><span class="pre">SELECT</span></code> statement into
groups of rows containing matching values. A simple <code class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clause may
contain any expression composed of input columns or it may be an ordinal
number selecting an output column by position (starting at one).</p>
<p>The following queries are equivalent. They both group the output by
the <code class="docutils literal"><span class="pre">nationkey</span></code> input column with the first query using the ordinal
position of the output column and the second query using the input
column name:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="n">nationkey</span> <span class="k">FROM</span> <span class="n">customer</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">2</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="n">nationkey</span> <span class="k">FROM</span> <span class="n">customer</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">nationkey</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clauses can group output by input column names not appearing in
the output of a select statement. For example, the following query generates
row counts for the <code class="docutils literal"><span class="pre">customer</span></code> table using the input column <code class="docutils literal"><span class="pre">mktsegment</span></code>:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">customer</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">mktsegment</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span> _col0
-------
 29968
 30142
 30189
 29949
 29752
(5 rows)
</pre></div>
</div>
<p>When a <code class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clause is used in a <code class="docutils literal"><span class="pre">SELECT</span></code> statement all output
expression must be either aggregate functions or columns present in
the <code class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clause.</p>
<p id="complex-grouping-operations"><strong>Complex Grouping Operations</strong></p>
<p>Presto also supports complex aggregations using the <code class="docutils literal"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code>, <code class="docutils literal"><span class="pre">CUBE</span></code>
and <code class="docutils literal"><span class="pre">ROLLUP</span></code> syntax. This syntax allows users to perform analysis that require
aggregation on multiple sets of columns in a single query. Complex grouping
operations do not support grouping on expressions composed of input columns.
Only column names or ordinals are allowed.</p>
<p>Complex grouping operations are often equivalent to a <code class="docutils literal"><span class="pre">UNION</span> <span class="pre">ALL</span></code> of simple
<code class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span></code> expressions, as shown in the following examples. This equivalence
does not apply, however, when the source of data for the aggregation
is non-deterministic.</p>
<p><strong>GROUPING SETS</strong></p>
<p>Grouping sets allow users to specify multiple lists of columns to group on.
The columns not part of a given sublist of grouping columns are set to <code class="docutils literal"><span class="pre">NULL</span></code>.</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">shipping</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span> origin_state | origin_zip | destination_state | destination_zip | package_weight
--------------+------------+-------------------+-----------------+----------------
 California   |      94131 | New Jersey        |            8648 |             13
 California   |      94131 | New Jersey        |            8540 |             42
 New Jersey   |       7081 | Connecticut       |            6708 |            225
 California   |      90210 | Connecticut       |            6927 |           1337
 California   |      94131 | Colorado          |           80302 |              5
 New York     |      10002 | New Jersey        |            8540 |              3
(6 rows)
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code> semantics are demonstrated by this example query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">origin_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">package_weight</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">shipping</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">GROUPING</span> <span class="k">SETS</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">),</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">),</span>
    <span class="p">(</span><span class="n">destination_state</span><span class="p">));</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span> origin_state | origin_zip | destination_state | _col0
--------------+------------+-------------------+-------
 New Jersey   | NULL       | NULL              |   225
 California   | NULL       | NULL              |  1397
 New York     | NULL       | NULL              |     3
 California   |      90210 | NULL              |  1337
 California   |      94131 | NULL              |    60
 New Jersey   |       7081 | NULL              |   225
 New York     |      10002 | NULL              |     3
 NULL         | NULL       | Colorado          |     5
 NULL         | NULL       | New Jersey        |    58
 NULL         | NULL       | Connecticut       |  1562
(10 rows)
</pre></div>
</div>
<p>The preceding query may be considered logically equivalent to a <code class="docutils literal"><span class="pre">UNION</span> <span class="pre">ALL</span></code> of
multiple <code class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span></code> queries:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">origin_state</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">package_weight</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">shipping</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">origin_state</span>

<span class="k">UNION</span> <span class="k">ALL</span>

<span class="k">SELECT</span> <span class="n">origin_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">package_weight</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">shipping</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">origin_state</span><span class="p">,</span> <span class="n">origin_zip</span>

<span class="k">UNION</span> <span class="k">ALL</span>

<span class="k">SELECT</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">package_weight</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">shipping</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">destination_state</span><span class="p">;</span>
</pre></div>
</div>
<p>However, the query with the complex grouping syntax (<code class="docutils literal"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code>, <code class="docutils literal"><span class="pre">CUBE</span></code>
or <code class="docutils literal"><span class="pre">ROLLUP</span></code>) will only read from the underlying data source once, while the
query with the <code class="docutils literal"><span class="pre">UNION</span> <span class="pre">ALL</span></code> reads the underlying data three times. This is why
queries with a <code class="docutils literal"><span class="pre">UNION</span> <span class="pre">ALL</span></code> may produce inconsistent results when the data
source is not deterministic.</p>
<p><strong>CUBE</strong></p>
<p>The <code class="docutils literal"><span class="pre">CUBE</span></code> operator generates all possible grouping sets (i.e. a power set)
for a given set of columns. For example, the query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">origin_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">package_weight</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">shipping</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">CUBE</span> <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">);</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">package_weight</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">shipping</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">GROUPING</span> <span class="k">SETS</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">),</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">),</span>
    <span class="p">(</span><span class="n">destination_state</span><span class="p">),</span>
    <span class="p">());</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span> origin_state | destination_state | _col0
--------------+-------------------+-------
 California   | New Jersey        |    55
 California   | Colorado          |     5
 New York     | New Jersey        |     3
 New Jersey   | Connecticut       |   225
 California   | Connecticut       |  1337
 California   | NULL              |  1397
 New York     | NULL              |     3
 New Jersey   | NULL              |   225
 NULL         | New Jersey        |    58
 NULL         | Connecticut       |  1562
 NULL         | Colorado          |     5
 NULL         | NULL              |  1625
(12 rows)
</pre></div>
</div>
<p><strong>ROLLUP</strong></p>
<p>The <code class="docutils literal"><span class="pre">ROLLUP</span></code> operator generates all possible subtotals for a given set of
columns. For example, the query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">origin_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">package_weight</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">shipping</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">ROLLUP</span> <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span> origin_state | origin_zip | _col2
--------------+------------+-------
 California   |      94131 |    60
 California   |      90210 |  1337
 New Jersey   |       7081 |   225
 New York     |      10002 |     3
 California   | NULL       |  1397
 New York     | NULL       |     3
 New Jersey   | NULL       |   225
 NULL         | NULL       |  1625
(8 rows)
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">package_weight</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">shipping</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">GROUPING</span> <span class="k">SETS</span> <span class="p">((</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">),</span> <span class="p">(</span><span class="n">origin_state</span><span class="p">),</span> <span class="p">());</span>
</pre></div>
</div>
<p><strong>Combining multiple grouping expressions</strong></p>
<p>Multiple grouping expressions in the same query are interpreted as having
cross-product semantics. For example, the following query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">package_weight</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">shipping</span>
<span class="k">GROUP</span> <span class="k">BY</span>
    <span class="k">GROUPING</span> <span class="k">SETS</span> <span class="p">((</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">)),</span>
    <span class="k">ROLLUP</span> <span class="p">(</span><span class="n">origin_zip</span><span class="p">);</span>
</pre></div>
</div>
<p>which can be rewritten as:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">package_weight</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">shipping</span>
<span class="k">GROUP</span> <span class="k">BY</span>
    <span class="k">GROUPING</span> <span class="k">SETS</span> <span class="p">((</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">)),</span>
    <span class="k">GROUPING</span> <span class="k">SETS</span> <span class="p">((</span><span class="n">origin_zip</span><span class="p">),</span> <span class="p">());</span>
</pre></div>
</div>
<p>is logically equivalent to:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">package_weight</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">shipping</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">GROUPING</span> <span class="k">SETS</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">),</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">));</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span> origin_state | destination_state | origin_zip | _col3
--------------+-------------------+------------+-------
 New York     | New Jersey        |      10002 |     3
 California   | New Jersey        |      94131 |    55
 New Jersey   | Connecticut       |       7081 |   225
 California   | Connecticut       |      90210 |  1337
 California   | Colorado          |      94131 |     5
 New York     | New Jersey        | NULL       |     3
 New Jersey   | Connecticut       | NULL       |   225
 California   | Colorado          | NULL       |     5
 California   | Connecticut       | NULL       |  1337
 California   | New Jersey        | NULL       |    55
(10 rows)
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">ALL</span></code> and <code class="docutils literal"><span class="pre">DISTINCT</span></code> quantifiers determine whether duplicate grouping
sets each produce distinct output rows. This is particularly useful when
multiple complex grouping sets are combined in the same query. For example, the
following query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">package_weight</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">shipping</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">ALL</span>
    <span class="k">CUBE</span> <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">),</span>
    <span class="k">ROLLUP</span> <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">);</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">package_weight</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">shipping</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">GROUPING</span> <span class="k">SETS</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">),</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">),</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">),</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">),</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">),</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">),</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">),</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">),</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">),</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">),</span>
    <span class="p">(</span><span class="n">destination_state</span><span class="p">),</span>
    <span class="p">());</span>
</pre></div>
</div>
<p>However, if the query uses the <code class="docutils literal"><span class="pre">DISTINCT</span></code> quantifier for the <code class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span></code>:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">package_weight</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">shipping</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">DISTINCT</span>
    <span class="k">CUBE</span> <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">),</span>
    <span class="k">ROLLUP</span> <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">);</span>
</pre></div>
</div>
<p>only unique grouping sets are generated:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">package_weight</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">shipping</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">GROUPING</span> <span class="k">SETS</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">),</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">origin_zip</span><span class="p">),</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">,</span> <span class="n">destination_state</span><span class="p">),</span>
    <span class="p">(</span><span class="n">origin_state</span><span class="p">),</span>
    <span class="p">(</span><span class="n">destination_state</span><span class="p">),</span>
    <span class="p">());</span>
</pre></div>
</div>
<p>The default set quantifier is <code class="docutils literal"><span class="pre">ALL</span></code>.</p>
</div>
<div class="section" id="having-clause">
<h2>HAVING Clause</h2>
<p>The <code class="docutils literal"><span class="pre">HAVING</span></code> clause is used in conjunction with aggregate functions and
the <code class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clause to control which groups are selected. A <code class="docutils literal"><span class="pre">HAVING</span></code>
clause eliminates groups that do not satisfy the given conditions.
<code class="docutils literal"><span class="pre">HAVING</span></code> filters groups after groups and aggregates are computed.</p>
<p>The following example queries the <code class="docutils literal"><span class="pre">customer</span></code> table and selects groups
with an account balance greater than the specified value:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="n">mktsegment</span><span class="p">,</span> <span class="n">nationkey</span><span class="p">,</span>
       <span class="k">CAST</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">acctbal</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">bigint</span><span class="p">)</span> <span class="k">AS</span> <span class="n">totalbal</span>
<span class="k">FROM</span> <span class="n">customer</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">mktsegment</span><span class="p">,</span> <span class="n">nationkey</span>
<span class="k">HAVING</span> <span class="k">sum</span><span class="p">(</span><span class="n">acctbal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5700000</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">totalbal</span> <span class="k">DESC</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span> _col0 | mktsegment | nationkey | totalbal
-------+------------+-----------+----------
  1272 | AUTOMOBILE |        19 |  5856939
  1253 | FURNITURE  |        14 |  5794887
  1248 | FURNITURE  |         9 |  5784628
  1243 | FURNITURE  |        12 |  5757371
  1231 | HOUSEHOLD  |         3 |  5753216
  1251 | MACHINERY  |         2 |  5719140
  1247 | FURNITURE  |         8 |  5701952
(7 rows)
</pre></div>
</div>
</div>
<div class="section" id="union-clause">
<h2>UNION Clause</h2>
<p>The <code class="docutils literal"><span class="pre">UNION</span></code> clause is used to combine the results of more than one
select statement into a single result set:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>query UNION [ALL | DISTINCT] query
</pre></div>
</div>
<p>The argument <code class="docutils literal"><span class="pre">ALL</span></code> or <code class="docutils literal"><span class="pre">DISTINCT</span></code> controls which rows are included in
the final result set. If the argument <code class="docutils literal"><span class="pre">ALL</span></code> is specified all rows are
included even if the rows are identical.  If the argument <code class="docutils literal"><span class="pre">DISTINCT</span></code>
is specified only unique rows are included in the combined result set.
If neither is specified, the behavior defaults to <code class="docutils literal"><span class="pre">DISTINCT</span></code>.</p>
<p>The following is an example of one of the simplest possible <code class="docutils literal"><span class="pre">UNION</span></code>
clauses. The following query selects the value <code class="docutils literal"><span class="pre">13</span></code> and combines
this result set with a second query which selects the value <code class="docutils literal"><span class="pre">42</span></code>:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="mi">13</span>
<span class="k">UNION</span>
<span class="k">SELECT</span> <span class="mi">42</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span> _col0
-------
    13
    42
(2 rows)
</pre></div>
</div>
<p>Multiple unions are processed left to right, unless the order is explicitly
specified via parentheses.</p>
</div>
<div class="section" id="order-by-clause">
<h2>ORDER BY Clause</h2>
<p>The <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></code> clause is used to sort a result set by one or more
output expressions:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>ORDER BY expression [ ASC | DESC ] [ NULLS { FIRST | LAST } ] [, ...]
</pre></div>
</div>
<p>Each expression may be composed of output columns or it may be an ordinal
number selecting an output column by position (starting at one). The
<code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></code> clause is evaluated as the last step of a query after any
<code class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span></code> or <code class="docutils literal"><span class="pre">HAVING</span></code> clause. The default null ordering is <code class="docutils literal"><span class="pre">NULLS</span> <span class="pre">LAST</span></code>,
regardless of the ordering direction.</p>
</div>
<div class="section" id="limit-clause">
<h2>LIMIT Clause</h2>
<p>The <code class="docutils literal"><span class="pre">LIMIT</span></code> clause restricts the number of rows in the result set.
<code class="docutils literal"><span class="pre">LIMIT</span> <span class="pre">ALL</span></code> is the same as omitting the <code class="docutils literal"><span class="pre">LIMIT</span></code> clause.
The following example queries a large table, but the limit clause restricts
the output to only have five rows (because the query lacks an <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></code>,
exactly which rows are returned is arbitrary):</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">orderdate</span> <span class="k">FROM</span> <span class="n">orders</span> <span class="k">LIMIT</span> <span class="mi">5</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span> o_orderdate
-------------
 1996-04-14
 1992-01-15
 1995-02-01
 1995-11-12
 1992-04-26
(5 rows)
</pre></div>
</div>
</div>
<div class="section" id="tablesample">
<h2>TABLESAMPLE</h2>
<p>There are multiple sample methods:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">BERNOULLI</span></code></dt>
<dd><p class="first">Each row is selected to be in the table sample with a probability of
the sample percentage. When a table is sampled using the Bernoulli
method, all physical blocks of the table are scanned and certain
rows are skipped (based on a comparison between the sample percentage
and a random value calculated at runtime).</p>
<p class="last">The probability of a row being included in the result is independent
from any other row. This does not reduce the time required to read
the sampled table from disk. It may have an impact on the total
query time if the sampled output is processed further.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">SYSTEM</span></code></dt>
<dd><p class="first">This sampling method divides the table into logical segments of data
and samples the table at this granularity. This sampling method either
selects all the rows from a particular segment of data or skips it
(based on a comparison between the sample percentage and a random
value calculated at runtime).</p>
<p class="last">The rows selected in a system sampling will be dependent on which
connector is used. For example, when used with Hive, it is dependent
on how the data is laid out on HDFS. This method does not guarantee
independent sampling probabilities.</p>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Neither of the two methods allow deterministic bounds on the number of rows returned.</p>
</div>
<p>Examples:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span> <span class="n">TABLESAMPLE</span> <span class="n">BERNOULLI</span> <span class="p">(</span><span class="mi">50</span><span class="p">);</span>

<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span> <span class="n">TABLESAMPLE</span> <span class="k">SYSTEM</span> <span class="p">(</span><span class="mi">75</span><span class="p">);</span>
</pre></div>
</div>
<p>Using sampling with joins:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">o</span><span class="p">.</span><span class="o">*</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="o">*</span>
<span class="k">FROM</span> <span class="n">orders</span> <span class="n">o</span> <span class="n">TABLESAMPLE</span> <span class="k">SYSTEM</span> <span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="k">JOIN</span> <span class="n">lineitem</span> <span class="n">i</span> <span class="n">TABLESAMPLE</span> <span class="n">BERNOULLI</span> <span class="p">(</span><span class="mi">40</span><span class="p">)</span>
  <span class="k">ON</span> <span class="n">o</span><span class="p">.</span><span class="n">orderkey</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">orderkey</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="unnest">
<span id="id1"></span><h2>UNNEST</h2>
<p><code class="docutils literal"><span class="pre">UNNEST</span></code> can be used to expand an <a class="reference internal" href="../language/types.html#array-type"><span class="std std-ref">ARRAY</span></a> or <a class="reference internal" href="../language/types.html#map-type"><span class="std std-ref">MAP</span></a> into a relation.
Arrays are expanded into a single column, and maps are expanded into two columns (key, value).
<code class="docutils literal"><span class="pre">UNNEST</span></code> can also be used with multiple arguments, in which case they are expanded into multiple columns,
with as many rows as the highest cardinality argument (the other columns are padded with nulls).
<code class="docutils literal"><span class="pre">UNNEST</span></code> can optionally have a <code class="docutils literal"><span class="pre">WITH</span> <span class="pre">ORDINALITY</span></code> clause, in which case an additional ordinality column
is added to the end.
<code class="docutils literal"><span class="pre">UNNEST</span></code> is normally used with a <code class="docutils literal"><span class="pre">JOIN</span></code> and can reference columns
from relations on the left side of the join.</p>
<p>Using a single column:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">student</span><span class="p">,</span> <span class="n">score</span>
<span class="k">FROM</span> <span class="n">tests</span>
<span class="k">CROSS</span> <span class="k">JOIN</span> <span class="k">UNNEST</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="k">AS</span> <span class="n">t</span> <span class="p">(</span><span class="n">score</span><span class="p">);</span>
</pre></div>
</div>
<p>Using multiple columns:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">numbers</span><span class="p">,</span> <span class="n">animals</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span>
<span class="k">FROM</span> <span class="p">(</span>
  <span class="k">VALUES</span>
    <span class="p">(</span><span class="nb">ARRAY</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="nb">ARRAY</span><span class="p">[</span><span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;bird&#39;</span><span class="p">]),</span>
    <span class="p">(</span><span class="nb">ARRAY</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="nb">ARRAY</span><span class="p">[</span><span class="s1">&#39;cow&#39;</span><span class="p">,</span> <span class="s1">&#39;pig&#39;</span><span class="p">])</span>
<span class="p">)</span> <span class="k">AS</span> <span class="n">x</span> <span class="p">(</span><span class="n">numbers</span><span class="p">,</span> <span class="n">animals</span><span class="p">)</span>
<span class="k">CROSS</span> <span class="k">JOIN</span> <span class="k">UNNEST</span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span> <span class="n">animals</span><span class="p">)</span> <span class="k">AS</span> <span class="n">t</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>  numbers  |     animals      |  n   |  a
-----------+------------------+------+------
 [2, 5]    | [dog, cat, bird] |    2 | dog
 [2, 5]    | [dog, cat, bird] |    5 | cat
 [2, 5]    | [dog, cat, bird] | NULL | bird
 [7, 8, 9] | [cow, pig]       |    7 | cow
 [7, 8, 9] | [cow, pig]       |    8 | pig
 [7, 8, 9] | [cow, pig]       |    9 | NULL
(6 rows)
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">WITH</span> <span class="pre">ORDINALITY</span></code> clause:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">numbers</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span>
<span class="k">FROM</span> <span class="p">(</span>
  <span class="k">VALUES</span>
    <span class="p">(</span><span class="nb">ARRAY</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span>
    <span class="p">(</span><span class="nb">ARRAY</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
<span class="p">)</span> <span class="k">AS</span> <span class="n">x</span> <span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
<span class="k">CROSS</span> <span class="k">JOIN</span> <span class="k">UNNEST</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span> <span class="k">WITH</span> <span class="k">ORDINALITY</span> <span class="k">AS</span> <span class="n">t</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>  numbers  | n | a
-----------+---+---
 [2, 5]    | 2 | 1
 [2, 5]    | 5 | 2
 [7, 8, 9] | 7 | 1
 [7, 8, 9] | 8 | 2
 [7, 8, 9] | 9 | 3
(5 rows)
</pre></div>
</div>
</div>
<div class="section" id="joins">
<h2>Joins</h2>
<p>Joins allow you to combine data from multiple relations.</p>
<div class="section" id="cross-join">
<h3>CROSS JOIN</h3>
<p>A cross join returns the Cartesian product (all combinations) of two
relations. Cross joins can either be specified using the explit
<code class="docutils literal"><span class="pre">CROSS</span> <span class="pre">JOIN</span></code> syntax or by specifying multiple relations in the
<code class="docutils literal"><span class="pre">FROM</span></code> clause.</p>
<p>Both of the following queries are equivalent:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">nation</span>
<span class="k">CROSS</span> <span class="k">JOIN</span> <span class="n">region</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">nation</span><span class="p">,</span> <span class="n">region</span><span class="p">;</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">nation</span></code> table contains 25 rows and the <code class="docutils literal"><span class="pre">region</span></code> table contains 5 rows,
so a cross join between the two tables produces 125 rows:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">n</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="n">nation</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="n">region</span>
<span class="k">FROM</span> <span class="n">nation</span> <span class="k">AS</span> <span class="n">n</span>
<span class="k">CROSS</span> <span class="k">JOIN</span> <span class="n">region</span> <span class="k">AS</span> <span class="n">r</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>     nation     |   region
----------------+-------------
 ALGERIA        | AFRICA
 ALGERIA        | AMERICA
 ALGERIA        | ASIA
 ALGERIA        | EUROPE
 ALGERIA        | MIDDLE EAST
 ARGENTINA      | AFRICA
 ARGENTINA      | AMERICA
...
(125 rows)
</pre></div>
</div>
</div>
<div class="section" id="qualifying-column-names">
<h3>Qualifying Column Names</h3>
<p>When two relations in a join have columns with the same name, the column
references must be qualified using the relation alias (if the relation
has an alias), or with the relation name:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">nation</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">region</span><span class="p">.</span><span class="n">name</span>
<span class="k">FROM</span> <span class="n">nation</span>
<span class="k">CROSS</span> <span class="k">JOIN</span> <span class="n">region</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="n">n</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">name</span>
<span class="k">FROM</span> <span class="n">nation</span> <span class="k">AS</span> <span class="n">n</span>
<span class="k">CROSS</span> <span class="k">JOIN</span> <span class="n">region</span> <span class="k">AS</span> <span class="n">r</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="n">n</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">name</span>
<span class="k">FROM</span> <span class="n">nation</span> <span class="n">n</span>
<span class="k">CROSS</span> <span class="k">JOIN</span> <span class="n">region</span> <span class="n">r</span><span class="p">;</span>
</pre></div>
</div>
<p>The following query will fail with the error <code class="docutils literal"><span class="pre">Column</span> <span class="pre">'name'</span> <span class="pre">is</span> <span class="pre">ambiguous</span></code>:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">name</span>
<span class="k">FROM</span> <span class="n">nation</span>
<span class="k">CROSS</span> <span class="k">JOIN</span> <span class="n">region</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="set-session.html" class="btn btn-neutral float-right" title="7.17. SET SESSION" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rollback.html" class="btn btn-neutral" title="7.15. ROLLBACK" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.144-SNAPSHOT',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>